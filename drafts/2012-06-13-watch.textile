---
categories: work
date: June 13, 2012
layout: article
title: watch -g
---

@watch@ (part of "procps":procps) is one of my favorite Unix command line utilities.  It repeatedly executes a command so you can watch the output change, and if you pass the optional @--diff/-d@ command line argument it highlights the changes between executions (or between any executions with @--difference=cumulative@).  It's great for one-off monitoring uses, like running @/sbin/ifconfig@ to see how frequently your network interfaces are experiencing errors or dropping packets, or running @/bin/ls -l@ to see how quickly some log files are growing, etc.

By default, @watch@ runs until either the command you are watching exits with an error or you interrupt it, but a colleague suggested an option to exit when the output changes.  This is useful for things like "Makefiles":make and shell scripts where you want to gate an automated process on an external resource.  For example, when integration testing a web application you need to wait for your application to fully start up before running the tests, or when upgrading network card drivers you need to wait for the kernel to reinitialize the interface before re-starting your applications that bind to that interface.  I wrote a patch that adds an optional @--chg-exit/-g@ command line argument for this behavior, so in these examples you could use @watch -g "curl http://localhost:3000/" && ./run_integration_tests.sh@ or @watch -g "ping <ip address of interface>" && ssh <ip address of interface> "restart_apps.sh"@.

I'm happy to say it was "merged upstream":merge and is part of "the latest procps release":announcement.

[announcement]http://www.freelists.org/post/procps/procps-333-released
[make]http://kent.spillner.org/blog/work/2009/12/30/make-all-environments.html
[merge]https://gitorious.org/procps/procps/merge_requests/1
[procps]http://procps.sf.net/
